# Alexandria Seeks
# ================

# In the middle of this story, you have to do many Alexandria Seeks.
# Those are automatically-generated mission sequences where you must
# search for some book or artifact.  They send you all over some area
# of the galaxy doing smaller missions.  Eventually you find your book
# or artifact, bring it back to the library, and get paid.  There are
# 6 levels of difficulty of Seeks: 0 for the youngest pilots, through 5
# for pilots that have explored the galaxy with tier 2 fleets.



# Level calculations
# ------------------

# Level 5 Calculation: nominally, you can fight fleets of tier 2
# ships, you've met everyone, and you have progressed at least a
# little bit in all of the alien stories.

mission "Alexandria Seek: Level 5 Calculation"
	landing
	repeat
	invisible
	source
		not
			attributes uninhabited
	to offer
		has "library card"
		or
			"armament deterrence" > 50000
			"combat rating" > 10000
		has "license: Wanderer Military"
		has "license: Coalition"
		has "license: Remnant Capital"
		has "Discovered Korath Space: fail"
		has "First Contact: Quarg: declined"
		or
			has "Disabled Ka'het: declined"
			has "First Contact: Ka'het: Remnant 1B: offered"
			has "First Contact: Ka'het: Quarg 1: offered"
	on offer
		"alexandria seeker level" >?= 5
		fail

# Level 4 Calculation: you can fight fleets of tier 1.5 ships, and you
# can land on planets in all regions of space.

mission "Alexandria Seek: Level 4 Calculation"
	landing
	repeat
	invisible
	source
		not
			attributes uninhabited
	to offer
		has "library card"
		or
			"armament deterrence" > 20000
			"combat rating" > 5000
		has "license: Wanderer Outfits"
		has "license: Coalition"
		has "license: Remnant"
		has "Discovered Korath Space: fail"
		has "Graveyard Label: fail"
		has "First Contact: Quarg: declined"
	on offer
		"alexandria seeker level" >?= 4
		fail

# Level 3 Calculation: you can fight fleets of tier 1 ships and you
# can land on planets in Wanderer, Remnant, and Coalition space.

mission "Alexandria Seek: Level 3 Calculation"
	landing
	repeat
	invisible
	source
		not
			attributes uninhabited
	to offer
		has "library card"
		or
			"armament deterrence" > 8000
			"combat rating" > 2500
		has "license: Wanderer Outfits"
		has "license: Coalition"
		has "license: Remnant"
		has "First Contact: Quarg: declined"
	on offer
		"alexandria seeker level" >?= 3
		fail

# Level 2 Calculation: you have a decent-sized fleet of medium
# warships, you've met the Hai, and you've met the Quarg.

mission "Alexandria Seek: Level 2 Calculation"
	landing
	repeat
	invisible
	source
		not
			attributes uninhabited
	to offer
		has "library card"
		or
			"armament deterrence" > 5000
			"combat rating" > 100
		has "First Contact: Quarg: declined"
		has "Discovered Hai Space: failed"
		"net worth" > 3000000
		has "event: war begins"
	on offer
		"alexandria seeker level" >?= 2
		fail

# Level 1 Calculation: you have your second ship or you are very good
# at using your first ship.

mission "Alexandria Seek: Level 1 Calculation"
	landing
	repeat
	invisible
	source
		not
			attributes uninhabited
	to offer
		has "library card"
		or
			"armament deterrence" > 800
			"combat rating" > 30
			"net worth" > 2000000
			"flagship bunks" > 20
			"flagship required crew" > 10
	on offer
		"alexandria seeker level" >?= 1
		fail

# Level 0 only requires a library card, so it does not need a
# detection mission



# Binomial-Distributed Random Number
# ----------------------------------

# This provides a consistent random number across all missions for
# deciding which Seek to use (if any) and which mission to use for the
# next step of the Seek.

mission "Alexandria Random Chance"
	landing
	invisible
	repeat
	source Alexandria
	on offer
		clear "alexandria random"

mission "Alexandria Random Chance [0]"
	landing
	invisible
	repeat
	source Alexandria
	to offer
		random < 30
	on offer
		"alexandria random" ++
		fail

mission "Alexandria Random Chance [1]"
	landing
	invisible
	repeat
	source Alexandria
	to offer
		random < 30
	on offer
		"alexandria random" ++
		fail

mission "Alexandria Random Chance [2]"
	landing
	invisible
	repeat
	source Alexandria
	to offer
		random < 30
	on offer
		"alexandria random" ++
		fail

mission "Alexandria Random Chance [3]"
	landing
	invisible
	repeat
	source Alexandria
	to offer
		random < 30
	on offer
		"alexandria random" ++
		fail

mission "Alexandria Random Chance [4]"
	landing
	invisible
	repeat
	source Alexandria
	to offer
		random < 30
	on offer
		"alexandria random" ++
		fail

mission "Alexandria Random Chance [5]"
	landing
	invisible
	repeat
	source Alexandria
	to offer
		random < 30
	on offer
		"alexandria random" ++
		fail

mission "Alexandria Random Chance [6]"
	landing
	invisible
	repeat
	source Alexandria
	to offer
		random < 30
	on offer
		"alexandria random" ++
		fail

mission "Alexandria Random Chance [7]"
	landing
	invisible
	repeat
	source Alexandria
	to offer
		random < 30
	on offer
		"alexandria random" ++
		fail

mission "Alexandria Random Chance [8]"
	landing
	invisible
	repeat
	source Alexandria
	to offer
		random < 30
	on offer
		"alexandria random" ++
		fail

mission "Alexandria Random Chance [9]"
	landing
	invisible
	repeat
	source Alexandria
	to offer
		random < 30
	on offer
		"alexandria random" ++
		fail
	


# Level 0 Seek: Paradise Planets
# ------------------------------

# This is the only safe region of space for an unmodified Shuttle or
# Star Barge.  We confine ourselves to simple transport missions in
# well-patrolled systems.

mission "Alexandria Seek Near Paradise Planets: Start"
	job
	repeat
	name "Alexandria Seek: <planet>"
	description "Meet a Seeker at <destination> to seek a book near the Paradise Planets.  Return it to Alexandria for 110,000 credits."
	passengers 1
	source Alexandria
	destination
		near Castor 0 4
		not planet Ingot
	to offer
		has "library card"
		not "alexandria seek active"
		or
			not "alexandria seeker level"
			and
				"alexandria seeker level" == 1
				"alexandria random" < 3
			and
				"alexandria seeker level" == 2
				"alexandria random" < 2
	on accept
		set "alexandria seek active"
		set "seek near paradise"
	on fail
		clear "alexandria seek active"
		clear "seek near paradise"
	on decline
		clear "alexandria seek active"
		clear "seek near paradise"

mission "Alexandria Seek Near Paradise Planets: Search"
	name "Alexandria Seek: <planet>"
	description "Continue to <destination> to seek a book near the Paradise Planets.  Return it to Alexandria for 110,000 credits."
	landing
	repeat
	name "Alexandria Seek: <planet>"
	source
		near Castor 0 4
		not planet Ingot
	destination
		near Castor 0 4
		not planet Ingot
		distance 3 20
		not
			attributes uninhabited
	to offer
		has "Alexandria Seek Near Paradise Planets: Start: done"
		has "seek near paradise"
		"seek near paradise" < 5
	on offer
		conversation
			branch first
				"seek near paradise" == 1
			branch found
				random < 30
				"seek near paradise" > 1
			`It isn't here, but I think it may be on <destination>.`
				goto choice
			label found
			apply
				"seek near paradise" = 4
			`It isn't here, but I think it may be on <destination>.`
				goto choice
			label first
			`Thank you for meeting me.  We'll start searching at <destination>.`
			label choice
			choice
				`"I'll take you to <destination>."`
					accept
				`"I'm sorry, but I don't have time to finish this Seek.  You will have to find another captain."`
					decline
	on fail
		clear "alexandria seek active"
		clear "seek near paradise"
	on decline
		clear "alexandria seek active"
		clear "seek near paradise"
	on complete
		"seek near paradise" ++

mission "Alexandria Seek Near Paradise Planets: Return"
	name "Alexandria Seek: <planet>"
	description "Return the book to Alexandria for 110,000 credits."
	landing
	repeat
	destination Alexandria
	source
		near Castor 0 4
		not planet Ingot
	to offer
		has "Alexandria Seek Near Paradise Planets: Start: done"
		has "Alexandria Seek Near Paradise Planets: Search: done"
		has "alexandria seek active"
		"seek near paradise" == 5
	on offer
		"seek near paradise" ++
		conversation
			`I have the book.  Let's take it back to the library at <destination> and get paid.`
			choice
				`"I'll take you to <destination>."`
					accept
				`"I'm sorry, but I don't have time to finish this Seek.  You will have to find another captain."`
					decline
	on fail
		clear "alexandria seek active"
		clear "seek near paradise"
	on decline
		clear "alexandria seek active"
		clear "seek near paradise"
	on complete
		payment 110000
		clear "alexandria seek active"
		clear "seek near paradise"

			
						
